<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../css/reset.css">
    <link rel="stylesheet" href="./../css/cad_maquina.css">
    <link rel="stylesheet" href="../css/navbar_sistema2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="sortcut icon" href="../imagens/icone_aviao.png" />
    <script type="text/javascript" src="../funcoes.js"></script>
    <title>Cadastro Máquina</title>
</head>

<body >
    <div class="site_cad_maquina">
        <header>
            <div class="header_mobile">
                <div class="grid_mobile">
                    <a href=""><img src="../imagens/TOWER_TECH.png" alt=""></a>
                    <i id="menu" onclick="mudar_icone()" class="fas fa-bars"></i>
                </div>
            </div>
            <div class="header_desktop">
                <div class="grid_desktop">
                    <div class="primeira_div">
                        <img src="../imagens/TOWER_TECH.png" alt="">
                        <img class="img_usuario" src="../imagens/Danilo.png" alt="" class="fernanda">
                        <h3>Bem Vindo(a), X!</h3>
                    </div>
                    <div class="cadastro">
                        <h5>CADASTRO</h5>
                        <Button>Cadastrar máquina</Button>
                    </div>
                    <div class="localizacao">
                        <h5>LOCALIZAÇÃO</h5>
                        <div class="scrollLocalizacao">
                            <div onclick="abrir_menu_maquinas()" class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                                <div class="maquinas">
                                    <h3>Maquina 1</h3>
                                </div>
                                <div class="maquinas">
                                    <h3>Maquina 2</h3>
                                </div>
                                <div class="maquinas">
                                    <h3>Maquina 3</h3>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                            <div class="torres">
                                <div class="a1">
                                    <h3>Torre Congonhas</h3>
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="index.html"><i class="fas fa-sign-out-alt"></i></a>
                </div>
            </div>
        </header>
        <section>
            <form id="cad_maquina" action="" onsubmit=" return cadastrar()">
                <h2>CADASTRE SUAS MÁQUINAS</h2>
                <div class="inputs_cadastro_maq">
                    <div class="inputs_cadastro_maq_divs">
                        <input name="name_marca" placeholder="Marca" class="inputs" id="id_marca" type="text">
                        <input name="name_nmr_serie" placeholder="Número de série" class="inputs" id="id_nmr_serie"
                            type="number">
                        <input name="name_mem_ram" placeholder="Capacidade RAM" class="inputs" id="id_ram"
                            type="number"><br>
                        <select class="inputs" name="torre" id="id_torre" onchange="teste(this.value)">
                            <option class="option" value="">---Torre---</option>
                            <option class="option" value="1">Torre Congonhas</option>
                            <option class="option" value="2">Torre Galeão</option>
                            <option class="option" value="3">Torre Viracopos</option>
                            <option class="option" value="4">Torre Santos Dumont</option>
                        </select>
                        <input type="text" style="display: none;" name="idComputador" id="idComp" >
                    </div>
                    <div class="inputs_cadastro_maq_divs">
                        <input name="name_modelo" placeholder="Modelo" class="inputs" id="id_modelo" type="text">
                        <input name="name_cpu" placeholder="Capacidade CPU" class="inputs" id="id_cpu" type="text">
                        <input name="name_disco" placeholder="Capacidade Disco" class="inputs" id="id_disco"
                            type="number">
                        <div class="botao">
                            <button>Enviar</button>
                            <div id="div_erro"></div>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </div>
</body>
<script src="../JS/cad_maquina.js"></script>

</html>

<script>
    verificar_autenticacao()
   

    function cadastrar() {
        var formulario = new URLSearchParams(new FormData(cad_maquina));
        fetch(`/usuarios/cadastrarComputador`, {
            method: "POST",
            body: formulario
        }).then(function (response) {

            if (response.ok) {
                alert("Maquina cadastrada com sucesso!")
                location.reload()

            } else {

                console.log('Erro de cadastro!');
                response.text().then(function (resposta) {
                    div_erro.innerHTML = resposta;
                });
            }
        });

        return false;
    }

    function teste(torre) {
        fetch(`/usuarios/idComputador/${torre}`, { cache: 'no-store' }).then(function (response) {
            
            if (response.ok) {                
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    console.log(resposta[0].ids);
                    idComp.value = resposta[0].ids += 1;
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados: ${error.message}`);
            });

        return false;
    }
    


</script>